{% extends 'base.html' %}
{% load static %}

{% block title %}Seleccionar Fecha - {{ hotel.nombre }}{% endblock %}

{% block content %}
<div class="reserva-container">
    <!-- Pasos del proceso -->
    <div class="reserva-steps">
        <div class="reserva-step active">
            <div class="step-circle">1</div>
            <span class="step-label">Fecha y Personas</span>
        </div>
        <div class="reserva-step">
            <div class="step-circle">2</div>
            <span class="step-label">Seleccionar Habitación</span>
        </div>
        <div class="reserva-step">
            <div class="step-circle">3</div>
            <span class="step-label">Datos Personales</span>
        </div>
        <div class="reserva-step">
            <div class="step-circle">4</div>
            <span class="step-label">Confirmación</span>
        </div>
    </div>
    
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="form-card">
                <div class="form-header">
                    <h2>Reservar en {{ hotel.nombre }}</h2>
                    <p>Selecciona la fecha y cantidad de personas para tu reserva</p>
                </div>
                
                <!-- Información del hotel -->
                <div class="reserva-summary mb-4">
                    <div class="summary-item">
                        <div class="summary-icon">
                            <i class="fas fa-hotel"></i>
                        </div>
                        <div class="summary-content">
                            <h5>Hotel</h5>
                            <p>{{ hotel.nombre }}</p>
                        </div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="summary-content">
                            <h5>Dirección</h5>
                            <p>{{ hotel.direccion }}</p>
                        </div>
                    </div>
                </div>
                
                <form method="POST" id="fechaForm">
                    {% csrf_token %}
                    
                    <div class="row g-4">
                        <!-- Fecha de reserva -->
                        <div class="col-md-6">
                            <div class="form-floating-custom">
                                <input type="date" 
                                       class="form-control" 
                                       id="fecha_reserva"
                                       name="fecha_reserva"
                                       value="{{ fecha_hoy }}"
                                       min="{{ fecha_minima }}"
                                       max="{{ fecha_maxima }}"
                                       required>
                                <label for="fecha_reserva">
                                    <i class="fas fa-calendar-day me-2"></i>Fecha de Reserva
                                </label>
                            </div>
                        </div>
                        
                        <!-- Cantidad de personas -->
                        <div class="col-md-6">
                            <div class="form-floating-custom">
                                <select class="form-select" 
                                        id="cantidad_personas"
                                        name="cantidad_personas"
                                        required>
                                    <option value="">Seleccione...</option>
                                    <option value="1">1 persona</option>
                                    <option value="2" selected>2 personas</option>
                                    <option value="3">3 personas</option>
                                    <option value="4">4 personas</option>
                                    <option value="5">5 personas</option>
                                    <option value="6">6 personas</option>
                                </select>
                                <label for="cantidad_personas">
                                    <i class="fas fa-users me-2"></i>Cantidad de Personas
                                </label>
                            </div>
                        </div>
                        
                        <!-- Previsualización -->
                        <div class="col-12">
                            <div class="alert alert-info alert-custom">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-info-circle me-3 fa-lg"></i>
                                    <div>
                                        <h6 class="mb-1">Resumen de selección</h6>
                                        <p class="mb-0" id="resumen_fecha">
                                            <strong>Fecha:</strong> {{ fecha_hoy }}
                                        </p>
                                        <p class="mb-0" id="resumen_personas">
                                            <strong>Personas:</strong> 2
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Botones -->
                    <div class="nav-buttons">
                        <a href="{% url 'home' %}" class="btn-secondary">
                            <i class="fas fa-arrow-left me-1"></i> Volver a Hoteles
                        </a>
                        <button type="submit" class="btn-primary">
                            Continuar a Habitaciones 
                            <i class="fas fa-arrow-right ms-2"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const fechaInput = document.getElementById('fecha_reserva');
    const personasSelect = document.getElementById('cantidad_personas');
    const resumenFecha = document.getElementById('resumen_fecha');
    const resumenPersonas = document.getElementById('resumen_personas');
    
    function formatearFecha(fechaStr) {
        const opciones = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        return new Date(fechaStr).toLocaleDateString('es-ES', opciones);
    }
    
    function actualizarResumen() {
        if (fechaInput.value) {
            resumenFecha.innerHTML = `<strong>Fecha:</strong> ${formatearFecha(fechaInput.value)}`;
        }
        if (personasSelect.value) {
            const personas = personasSelect.value;
            const texto = personas === '1' ? 'persona' : 'personas';
            resumenPersonas.innerHTML = `<strong>Personas:</strong> ${personas} ${texto}`;
        }
    }
    
    fechaInput.addEventListener('change', actualizarResumen);
    personasSelect.addEventListener('change', actualizarResumen);
    
    // Validar fecha futura
    fechaInput.addEventListener('change', function() {
        const hoy = new Date().toISOString().split('T')[0];
        if (this.value < hoy) {
            alert('La fecha no puede ser anterior a hoy.');
            this.value = hoy;
            actualizarResumen();
        }
    });
    
    actualizarResumen();
});
</script>
{% endblock %}